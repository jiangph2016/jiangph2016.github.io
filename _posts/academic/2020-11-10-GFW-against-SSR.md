---
layout: post
title: 【精读】How China Detects and Blocks Shadowsocks
category: 学术
tags: 论文
keywords: GFW
---
* content
{:toc}



原文地址:<https://dl.acm.org/doi/abs/10.1145/3419394.3423644>  
DOI:10.1145/3419394.3423644  
会议：IMC2020

# GFW检测和屏蔽ShadowSocks的方法

shadowsocks是中国最受欢迎的XX工具，在2019年5月开始有大量用户开始报告shadowsocks被屏蔽而不能使用的情况。  

根据实验发现，GFW使用每个连接中第一个数据包的长度和熵来识别可能的Shadowsocks连接，然后将七种不同的探针发送到服务器来验证。

## 介绍

自从2017年10月以来，有些用户开始报告自己的shadowsocks服务器开始不可用，尤其是在某些特别时期。  

根据作者的研究发现，GFW使用被动流量分析和主动探测组合来识别shadosocks服务器。

## 背景

shadowsock协议通过对数据加密使其显示为随机的字节流。  



## 探针

回答以下问题：
- 在什么情况下观察到了何种类型的探针
- 探针的来源
- 探针是否有指纹信息
- 一个连接对探针响应的延迟有多长

### 实验
搭建服务器，实验从2019年9月29日到2020年1月21日，进行了4个月。
使用不同的加密算法，和两个版本Shadowsocks-libv和OutlineVPN 来扩大覆盖范围。

### 探针类型

一共观察到51837种探针，有5种基于重放的探针

- R1 完全相同的重放
- R2 修改0字节后重放
- R3 修改0-7字节和62-63字节后重放
- R4 修改16字节后重放
- R5 修改6-16字节后重放 


其中R3,R4,R5的探针仅仅发送到OutlineVPN服务器，R5探针仅仅观察到两种

两种探针类型看起来随机，长度各异

- NR1 长度在7-9,11-113,15-17,21-23,32-34,40-42,48-50
- NR2 长度正好是221字节

### 探针来源

这些探针来自于12300个不同的IP地址，超过75%的地址发送了超过1个探针


## 触发探针
作者猜测有两种方式发送探针，第一种是大规模的端口测试，但是实验中那些没有启动SSR的服务器并没有收到探针，所以这种可能性排除。第二种是仅仅对可疑的ShadowSocks服务器发送探针。

- 触发探针需要多少流量
- 为什么R3,R4,R5的探针仅仅发送到OutlineVPN服务器
- 是否考虑数据包的长度
- 是否考虑数据包载荷的熵
- 由外到内的shadowsocks连接是否会产生一样多的探测

## 对探针进行指纹识别

- IP ID  : 找不到清晰的模式
- TTL    :  在46-50范围内
- TCP端口 : 大约90%的探针来自32768-60999端口，从没有探针使用低于1024的端口（前人的工作观察到所有的端口都在使用）
- TCPval 一个32位计数器，以固定的速率增加
### 实验

设计了一个TCP客户端连接到服务器，仅发送一个指定长度和指定香农熵的数据包  
TCP服务器有两种模式，sink和respond，前者不响应任何数据，后者响应1-1000字节的随机数据  

Exp # |Client Length (bytes) |Client Entropy |Server Mode
--|--|--|--
1.a |[1,1000]| > 7  |sink 
1.b |[1,1000]| > 7  |responding 
2 |[1,1000]  |< 2   |sink 
3 |[1,2000]  |[0,8] |sink

### 实验结果
