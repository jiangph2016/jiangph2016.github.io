---
layout: post
title: C语言编写http服务器记录-libevent笔记篇
category: 学习
tags: C
keywords: http,Linux,Socket
---

* content
{:toc}

## bufferevent

## evconnlistener_new_bind

### 简介

evconnlistener其实是对event_base和event的封装而已。

```C
//一系列的工作函数，因为listener可以用于不同的协议。
struct evconnlistener_ops {
    int (*enable)(struct evconnlistener *);
    int (*disable)(struct evconnlistener *);
    void (*destroy)(struct evconnlistener *);
    void (*shutdown)(struct evconnlistener *);
    evutil_socket_t (*getfd)(struct evconnlistener *);
    struct event_base *(*getbase)(struct evconnlistener *);
};

//一层一层封装，加上隔离
struct evconnlistener {
    const struct evconnlistener_ops *ops;   //操作函数
    void *lock;                             //锁变量，用于线程安全
    evconnlistener_cb cb;                   //用户的回调函数
    evconnlistener_errorcb errorcb;         //发生错误时的回调函数
    void *user_data;                        //回调函数的参数，当回调函数执行时候，通过形参传入回调函数内部
    unsigned flags;                         //属性标志 ，例如socket套接字属性，可以是阻塞，非阻塞，reuse等。
    short refcnt;                           //引用计数
    unsigned enabled : 1;                   //位域为1.即只需一个比特位来存储这个成员 
};
struct evconnlistener_event {
    struct evconnlistener base;
    struct event listener;     //内部event,插入到event_base，完成监听
};
```




## 参考

[libevent中的bufferevent原理](https://www.cnblogs.com/nengm1988/p/8203784.html)  
[详解libevent网络库（一）---框架的搭建](https://blog.csdn.net/Lemon_tea666/article/details/92637297)  
[详解libevent网络库（二）---即时聊天通讯](https://blog.csdn.net/Lemon_tea666/article/details/92797520)  
[libevent绑定、监听和读写数据](http://www.imooc.com/article/details/id/291139)  
[使用bufferevent进行libevent服务端和客户端的开发
](https://www.cnblogs.com/charlesblc/p/5456128.html)
[Libevent源码分析-----连接监听器evconnlistener](https://blog.csdn.net/luotuo44/article/details/38800363)